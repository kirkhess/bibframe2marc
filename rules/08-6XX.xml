<?xml version='1.0'?>
<rules xmlns="http://www.loc.gov/bf2marc"
       xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
       xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
       xmlns:bf="http://id.loc.gov/ontologies/bibframe/"
       xmlns:bflc="http://id.loc.gov/ontologies/bflc/"
       xmlns:madsrdf="http://www.loc.gov/mads/rdf/v1#"
       xmlns:marc="http://www.loc.gov/MARC21/slim"
       xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

  <!-- subjects -->
  <select xpath="bf:Work/bf:subject[not(*/*[local-name()='code'])]">
    <var name="vScriptSubtag">
      <transform>
        <xsl:call-template name="tScriptCode">
          <xsl:with-param name="pXmlLang" select="*/rdfs:label/@xml:lang"/>
        </xsl:call-template>
      </transform>
    </var>
    <switch>
      <case test="$vScriptSubtag='' or translate($vScriptSubtag,$upper,$lower)=translate($pCatScript,$upper,$lower)">
        <switch>
          <!-- 600 -->
          <case test="*[(local-name()='PersonalName' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#PersonalName'] or
                      local-name()='FamilyName' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#FamilyName'] or
                      local-name()='Person' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Person'] or
                      local-name()='Family' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Family'] or
                      local-name(madsrdf:componentList/*[1])='PersonalName' or madsrdf:componentList/*[1]/rdf:type/@rdf:resource='http://www.loc.gov/mads/rdf/v1#PersonalName' or
                      local-name(madsrdf:componentList/*[1])='FamilyName' or madsrdf:componentList/*[1]/rdf:type/@rdf:resource='http://www.loc.gov/mads/rdf/v1#FamilyName' or
                      local-name(madsrdf:componentList/*[1])='Person' or madsrdf:componentList/*[1]/rdf:type/@rdf:resource='http://id.loc.gov/ontologies/bibframe/Person' or
                      local-name(madsrdf:componentList/*[1])='Family' or madsrdf:componentList/*[1]/rdf:type/@rdf:resource='http://id.loc.gov/ontologies/bibframe/Family' or
                      bf:contribution/*/bf:agent/*[local-name()='PersonalName' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#PersonalName'] or local-name()='FamilyName' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#FamilyName'] or local-name()='Person' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Person'] or local-name()='Family' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Family']] or
                      madsrdf:componentList/*[1]/bf:contribution/*/bf:agent/*[local-name()='PersonalName' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#PersonalName'] or local-name()='FamilyName' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#FamilyName'] or local-name()='Person' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Person'] or local-name()='Family' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Family']]) and
                      (madsrdf:componentList or madsrdf:authoritativeLabel)]">
            <df tag="600">
              <ind1 default="1">
                <switch>
                  <case test="*[local-name()='Family' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Family'] or
                              local-name()='FamilyName' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#FamilyName'] or
                              local-name(madsrdf:componentList/*[1])='Family' or madsrdf:componentList/*[1]/rdf:type/@rdf:resource='http://id.loc.gov/ontologies/bibframe/Family' or
                              local-name(madsrdf:componentList/*[1])='FamilyName' or madsrdf:componentList/*[1]/rdf:type/@rdf:resource='http://www.loc.gov/mads/rdf/v1#FamilyName' or
                              bf:Work/bf:contribution/*/bf:agent/*[local-name()='Family' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Family']] or
                              bf:Work/bf:contribution/*/bf:agent/*[local-name()='FamilyName' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#FamilyName']] or
                              madsrdf:componentList/*[1]/bf:Work/bf:contribution/*/bf:agent/*[local-name()='Family' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Family']] or
                              madsrdf:componentList/*[1]/bf:Work/bf:contribution/*/bf:agent/*[local-name()='FamilyName' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#FamilyName']]]">3</case>
                </switch>
              </ind1>
              <ind2 default="4">
                <switch>
                  <case test="*/bf:source/bf:Source/bf:code='lcsh' or
                              */bf:source[@rdf:resource='http://id.loc.gov/authorities/subjects' or */@rdf:about='http://id.loc.gov/authorities/subjects'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='lcsh'">0</case>
                  <case test="*/bf:source/bf:Source/bf:code='lcshac' or
                              */bf:source[@rdf:resource='http://id.loc.gov/authorities/childrensSubjects' or */@rdf:about='http://id.loc.gov/authorities/childrensSubjects'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='lcshac'">1</case>
                  <case test="*/bf:source/bf:Source/bf:code='mesh' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/mesh' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/mesh'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='mesh'">2</case>
                  <case test="*/bf:source/bf:Source/bf:code='nal' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/nal' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/nal'] or
                              */madsrdf:componentList/*[1]/*/bf:source/bf:Source/bf:code='nal'">3</case>
                  <case test="*/bf:source/bf:Source/bf:code='cash' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/cash' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/cash'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='cash'">5</case>
                  <case test="*/bf:source/bf:Source/bf:code='rvm' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/rvm' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/rvm'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='rvm'">6</case>
                  <case test="*/bf:source or */madsrdf:componentList/*[1]/bf:source">7</case>
                </switch>
              </ind2>
              <sf code="3" chopPunct="true" repeatable="false">
                <select xpath="*/bflc:appliesTo/bflc:AppliesTo/rdfs:label"/>
              </sf>

              <!-- name subfields -->
              <select xpath="*[local-name()='PersonalName' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#PersonalName'] or local-name()='FamilyName' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#FamilyName'] or local-name()='Person' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Person'] or local-name()='Family' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Family']] |
                             */madsrdf:componentList/*[1] |
                             bf:Work/bf:contribution/*/bf:agent/* |
                             */madsrdf:componentList/*[1]/bf:Work/bf:contribution/*/bf:agent/*">
                <sf code="a" chopPunct="true" repeatable="false">
                  <switch>
                    <case test="madsrdf:elementList/madsrdf:FullNameElement/madsrdf:elementValue">
                      <select xpath="madsrdf:elementList/madsrdf:FullNameElement/madsrdf:elementValue[1]"/>
                    </case>
                    <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                    <case test="default"><select xpath="rdfs:label"/></case>
                  </switch>
                </sf>
                <sf code="c" chopPunct="true">
                  <select xpath="madsrdf:elementList/madsrdf:TermsOfAddressNameElement/madsrdf:elementValue"/>
                </sf>
                <sf code="d" chopPunct="true" repeatable="false">
                  <select xpath="madsrdf:elementList/madsrdf:DateNameElement/madsrdf:elementValue"/>
                </sf>
                <sf code="e" chopPunct="true">
                  <select xpath="../../bf:role/*[rdfs:label or madsrdf:authoritativeLabel]">
                    <switch>
                      <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                      <case test="default"><select xpath="rdfs:label"/></case>
                    </switch>
                  </select>
                </sf>
                <sf code="q" chopPunct="true" repeatable="false"><select xpath="madsrdf:fullerName/*/rdfs:label"/></sf>
                <sf code="4">
                  <select xpath="../../bf:role/*[madsrdf:code or bf:code]">
                    <switch>
                      <case test="madsrdf:code">
                        <select xpath="madsrdf:code"/>
                      </case>
                      <case test="default"><select xpath="bf:code"/></case>
                    </switch>
                  </select>
                </sf>
                <sf code="4">
                  <select xpath="../../bf:role/bf:Role/@rdf:about|../../bf:role/@rdf:resource"/>
                </sf>
                <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
                <sf code="0">
                  <select xpath="bf:identifiedBy/bf:Identifier">
                    <transform>
                      <xsl:variable name="vIdType">
                        <xsl:call-template name="tChopPunct">
                          <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                        </xsl:call-template>
                      </xsl:variable>
                      <xsl:choose>
                        <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                        <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                      </xsl:choose>
                    </transform>
                  </select>
                </sf>
              </select>

              <!-- title subfields -->
              <select xpath="bf:Work">
                <sf code="t" chopPunct="true" repeatable="false">
                  <select xpath="bf:title/bf:Title[not(contains(rdf:type/@rdf:resource,'bibframe'))]">
                    <switch>
                      <case test="bf:mainTitle"><select xpath="bf:mainTitle"/></case>
                      <case test="default"><select xpath="rdfs:label"/></case>
                    </switch>
                  </select>
                </sf>
                <sf code="f" chopPunct="true" repeatable="false"><select xpath="bf:originDate"/></sf>
                <sf code="l" chopPunct="true" repeatable="false">
                  <select xpath="bf:language/*/rdfs:label|bf:language/*/madsrdf:authoritativeLabel"/>
                </sf>
                <sf code="m" chopPunct="true"><select xpath="bf:musicMedium/bf:MusicMedium/rdfs:label"/></sf>
                <sf code="n" chopPunct="true"><select xpath="bf:title/bf:Title[not(contains(rdf:type/@rdf:resource,'bibframe'))][1]/bf:partNumber"/></sf>
                <sf code="p" chopPunct="true"><select xpath="bf:title/bf:Title[not(contains(rdf:type/@rdf:resource,'bibframe'))][1]/bf:partName"/></sf>
                <sf code="r" chopPunct="true" repeatable="false"><select xpath="bf:musicKey"/></sf>
                <sf code="s" chopPunct="true"><select xpath="bf:version"/></sf>
                <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
                <sf code="0">
                  <select xpath="bf:identifiedBy/bf:Identifier">
                    <transform>
                      <xsl:variable name="vIdType">
                        <xsl:call-template name="tChopPunct">
                          <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                        </xsl:call-template>
                      </xsl:variable>
                      <xsl:choose>
                        <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                        <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                      </xsl:choose>
                    </transform>
                  </select>
                </sf>
              </select>

              <!-- subdivisions -->
              <select xpath="*/madsrdf:componentList/*">
                <switch>
                  <case test="position() &gt; 1">
                    <switch>
                      <case test="local-name()='GenreForm' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#GenreForm']">
                        <sf code="v" chopPunct="true">
                          <switch>
                            <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                            <case test="default"><select xpath="rdfs:label"/></case>
                          </switch>
                        </sf>
                      </case>
                      <case test="local-name()='Temporal' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Temporal']">
                        <sf code="y" chopPunct="true">
                          <switch>
                            <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                            <case test="default"><select xpath="rdfs:label"/></case>
                          </switch>
                        </sf>
                      </case>
                      <case test="local-name()='Geographic' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Geographic']">
                        <sf code="z" chopPunct="true">
                          <switch>
                            <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                            <case test="default"><select xpath="rdfs:label"/></case>
                          </switch>
                        </sf>
                      </case>
                      <case test="default">
                        <sf code="x" chopPunct="true">
                          <switch>
                            <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                            <case test="default"><select xpath="rdfs:label"/></case>
                          </switch>
                        </sf>
                      </case>
                    </switch>
                    <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
                    <sf code="0">
                      <select xpath="bf:identifiedBy/bf:Identifier">
                        <transform>
                          <xsl:variable name="vIdType">
                            <xsl:call-template name="tChopPunct">
                              <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                            </xsl:call-template>
                          </xsl:variable>
                          <xsl:choose>
                            <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                            <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                          </xsl:choose>
                        </transform>
                      </select>
                    </sf>
                  </case>
                </switch>
              </select>

              <!-- $2 if source not in ind2 -->
              <select xpath="*/bf:source|*/madsrdf:componentList/*[1]/bf:source">
                <var name="vSourceUri">
                  <switch>
                    <case test="@rdf:resource"><transform><xsl:value-of select="@rdf:resource"/></transform></case>
                    <case test="*/@rdf:about"><transform><xsl:value-of select="*/@rdf:about"/></transform></case>
                  </switch>
                </var>
                <switch>
                  <case test="$vSourceUri != 'http://id.loc.gov/authorities/subjects' and
                              bf:Source/bf:code != 'lcsh' and
                              $vSourceUri != 'http://id.loc.gov/authorities/childrensSubjects' and
                              bf:Source/bf:code != 'lcshac' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/mesh' and
                              bf:Source/bf:code != 'mesh' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/nal' and
                              bf:Source/bf:code != 'nal' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/cash' and
                              bf:Source/bf:code != 'cash' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/rvm' and
                              bf:Source/bf:code != 'rvm'">
                    <sf code="2">
                      <switch>
                        <case test="bf:Source/bf:code"><transform><xsl:value-of select="bf:Source/bf:code"/></transform></case>
                        <case test="$vSourceUri != ''">
                          <switch>
                            <case test="contains($vSourceUri,'id.loc.gov')">
                              <transform>
                                <xsl:call-template name="tUriCode">
                                  <xsl:with-param name="pUri" select="$vSourceUri"/>
                                </xsl:call-template>
                              </transform>
                            </case>
                            <case test="default"><transform><xsl:value-of select="$vSourceUri"/></transform></case>
                          </switch>
                        </case>
                        <case test="default"><transform><xsl:value-of select="bf:Source/rdfs:label"/></transform></case>
                      </switch>
                    </sf>
                  </case>
                </switch>
              </select>
            </df>
          </case>

          <!-- 610 -->
          <case test="*[(local-name()='CorporateName' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#CorporateName'] or
                      local-name()='Organization' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Organization'] or
                      local-name()='Jurisdiction' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Jurisdiction'] or
                      local-name(madsrdf:componentList/*[1])='CorporateName' or madsrdf:componentList/*[1]/rdf:type/@rdf:resource='http://www.loc.gov/mads/rdf/v1#CorporateName' or
                      local-name(madsrdf:componentList/*[1])='Organization' or madsrdf:componentList/*[1]/rdf:type/@rdf:resource='http://id.loc.gov/ontologies/bibframe/Organization' or
                      local-name(madsrdf:componentList/*[1])='Jurisdiction' or madsrdf:componentList/*[1]/rdf:type/@rdf:resource='http://id.loc.gov/ontologies/bibframe/Jurisdiction' or
                      bf:contribution/*/bf:agent/*[local-name()='CorporateName' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#CorporateName'] or local-name()='Organization' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Organization'] or local-name()='Jurisdiction' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Jurisdiction']] or
                      madsrdf:componentList/*[1]/bf:contribution/*/bf:agent/*[local-name()='CorporateName' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#CorporateName'] or local-name()='Organization' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Organization'] or local-name()='Jurisdiction' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Jurisdiction']]) and
                      (madsrdf:componentList or madsrdf:authoritativeLabel)]">
            <df tag="610">
              <ind1 default="2">
                <switch>
                  <case test="*[local-name()='Jurisdiction' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Jurisdiction'] or
                              local-name(madsrdf:componentList/*[1])='Jurisdiction' or madsrdf:componentList/*[1]/rdf:type/@rdf:resource='http://id.loc.gov/ontologies/bibframe/Jurisdiction' or
                              bf:Work/bf:contribution/*/bf:agent/*[local-name()='Jurisdiction' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Jurisdiction']] or
                              madsrdf:componentList/*[1]/bf:Work/bf:contribution/*/bf:agent/*[local-name()='Jurisdiction' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Jurisdiction']]]">1</case>
                </switch>
              </ind1>
              <ind2 default="4">
                <switch>
                  <case test="*/bf:source/bf:Source/bf:code='lcsh' or
                              */bf:source[@rdf:resource='http://id.loc.gov/authorities/subjects' or */@rdf:about='http://id.loc.gov/authorities/subjects'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='lcsh'">0</case>
                  <case test="*/bf:source/bf:Source/bf:code='lcshac' or
                              */bf:source[@rdf:resource='http://id.loc.gov/authorities/childrensSubjects' or */@rdf:about='http://id.loc.gov/authorities/childrensSubjects'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='lcshac'">1</case>
                  <case test="*/bf:source/bf:Source/bf:code='mesh' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/mesh' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/mesh'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='mesh'">2</case>
                  <case test="*/bf:source/bf:Source/bf:code='nal' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/nal' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/nal'] or
                              */madsrdf:componentList/*[1]/*/bf:source/bf:Source/bf:code='nal'">3</case>
                  <case test="*/bf:source/bf:Source/bf:code='cash' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/cash' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/cash'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='cash'">5</case>
                  <case test="*/bf:source/bf:Source/bf:code='rvm' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/rvm' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/rvm'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='rvm'">6</case>
                  <case test="*/bf:source or */madsrdf:componentList/*[1]/bf:source">7</case>
                </switch>
              </ind2>
              <sf code="3" chopPunct="true" repeatable="false">
                <select xpath="*/bflc:appliesTo/bflc:AppliesTo/rdfs:label"/>
              </sf>

              <!-- name subfields -->
              <select xpath="*[local-name()='CorporateName' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#CorporateName'] or local-name()='Organization' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Organization'] or local-name()='Jurisdiction' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Jurisdiction']] |
                             */madsrdf:componentList/*[1] |
                             bf:Work/bf:contribution/*/bf:agent/* |
                             */madsrdf:componentList/*[1]/bf:Work/bf:contribution/*/bf:agent/*">
                <sf code="a" chopPunct="true" repeatable="false">
                  <switch>
                    <case test="madsrdf:elementList">
                      <select xpath="madsrdf:elementList/*[1]/madsrdf:elementValue"/>
                    </case>
                    <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                    <case test="default"><select xpath="rdfs:label"/></case>
                  </switch>
                </sf>
                <sf code="b" chopPunct="true">
                  <select xpath="madsrdf:elementList/*[position() &gt; 1]/madsrdf:elementValue"/>
                </sf>
                <sf code="e" chopPunct="true">
                  <select xpath="../../bf:role/*[rdfs:label or madsrdf:authoritativeLabel]">
                    <switch>
                      <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                      <case test="default"><select xpath="rdfs:label"/></case>
                    </switch>
                  </select>
                </sf>
                <!-- nac $u -->
                <sf code="4">
                  <select xpath="../../bf:role/*[madsrdf:code or bf:code]">
                    <switch>
                      <case test="madsrdf:code">
                        <select xpath="madsrdf:code"/>
                      </case>
                      <case test="default"><select xpath="bf:code"/></case>
                    </switch>
                  </select>
                </sf>
                <sf code="4">
                  <select xpath="../../bf:role/bf:Role/@rdf:about|../../bf:role/@rdf:resource"/>
                </sf>
                <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
                <sf code="0">
                  <select xpath="bf:identifiedBy/bf:Identifier">
                    <transform>
                      <xsl:variable name="vIdType">
                        <xsl:call-template name="tChopPunct">
                          <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                        </xsl:call-template>
                      </xsl:variable>
                      <xsl:choose>
                        <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                        <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                      </xsl:choose>
                    </transform>
                  </select>
                </sf>
              </select>

              <!-- title subfields -->
              <select xpath="bf:Work">
                <sf code="t" chopPunct="true" repeatable="false">
                  <select xpath="bf:title/bf:Title[not(contains(rdf:type/@rdf:resource,'bibframe'))]">
                    <switch>
                      <case test="bf:mainTitle"><select xpath="bf:mainTitle"/></case>
                      <case test="default"><select xpath="rdfs:label"/></case>
                    </switch>
                  </select>
                </sf>
                <sf code="d" chopPunct="true"><select xpath="bf:legalDate"/></sf>
                <sf code="f" chopPunct="true" repeatable="false"><select xpath="bf:originDate"/></sf>
                <sf code="l" chopPunct="true" repeatable="false">
                  <select xpath="bf:language/*/rdfs:label|bf:language/*/madsrdf:authoritativeLabel"/>
                </sf>
                <sf code="m" chopPunct="true"><select xpath="bf:musicMedium/bf:MusicMedium/rdfs:label"/></sf>
                <sf code="n" chopPunct="true"><select xpath="bf:title/bf:Title[not(contains(rdf:type/@rdf:resource,'bibframe'))][1]/bf:partNumber"/></sf>
                <sf code="p" chopPunct="true"><select xpath="bf:title/bf:Title[not(contains(rdf:type/@rdf:resource,'bibframe'))][1]/bf:partName"/></sf>
                <sf code="r" chopPunct="true" repeatable="false"><select xpath="bf:musicKey"/></sf>
                <sf code="s" chopPunct="true"><select xpath="bf:version"/></sf>
                <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
                <sf code="0">
                  <select xpath="bf:identifiedBy/bf:Identifier">
                    <transform>
                      <xsl:variable name="vIdType">
                        <xsl:call-template name="tChopPunct">
                          <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                        </xsl:call-template>
                      </xsl:variable>
                      <xsl:choose>
                        <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                        <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                      </xsl:choose>
                    </transform>
                  </select>
                </sf>
              </select>

              <!-- subdivisions -->
              <select xpath="*/madsrdf:componentList/*">
                <switch>
                  <case test="position() &gt; 1">
                    <switch>
                      <case test="local-name()='GenreForm' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#GenreForm']">
                        <sf code="v" chopPunct="true">
                          <switch>
                            <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                            <case test="default"><select xpath="rdfs:label"/></case>
                          </switch>
                        </sf>
                      </case>
                      <case test="local-name()='Temporal' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Temporal']">
                        <sf code="y" chopPunct="true">
                          <switch>
                            <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                            <case test="default"><select xpath="rdfs:label"/></case>
                          </switch>
                        </sf>
                      </case>
                      <case test="local-name()='Geographic' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Geographic']">
                        <sf code="z" chopPunct="true">
                          <switch>
                            <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                            <case test="default"><select xpath="rdfs:label"/></case>
                          </switch>
                        </sf>
                      </case>
                      <case test="default">
                        <sf code="x" chopPunct="true">
                          <switch>
                            <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                            <case test="default"><select xpath="rdfs:label"/></case>
                          </switch>
                        </sf>
                      </case>
                    </switch>
                    <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
                    <sf code="0">
                      <select xpath="bf:identifiedBy/bf:Identifier">
                        <transform>
                          <xsl:variable name="vIdType">
                            <xsl:call-template name="tChopPunct">
                              <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                            </xsl:call-template>
                          </xsl:variable>
                          <xsl:choose>
                            <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                            <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                          </xsl:choose>
                        </transform>
                      </select>
                    </sf>
                  </case>
                </switch>
              </select>

              <!-- $2 if source not in ind2 -->
              <select xpath="*/bf:source|*/madsrdf:componentList/*[1]/bf:source">
                <var name="vSourceUri">
                  <switch>
                    <case test="@rdf:resource"><transform><xsl:value-of select="@rdf:resource"/></transform></case>
                    <case test="*/@rdf:about"><transform><xsl:value-of select="*/@rdf:about"/></transform></case>
                  </switch>
                </var>
                <switch>
                  <case test="$vSourceUri != 'http://id.loc.gov/authorities/subjects' and
                              bf:Source/bf:code != 'lcsh' and
                              $vSourceUri != 'http://id.loc.gov/authorities/childrensSubjects' and
                              bf:Source/bf:code != 'lcshac' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/mesh' and
                              bf:Source/bf:code != 'mesh' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/nal' and
                              bf:Source/bf:code != 'nal' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/cash' and
                              bf:Source/bf:code != 'cash' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/rvm' and
                              bf:Source/bf:code != 'rvm'">
                    <sf code="2">
                      <switch>
                        <case test="bf:Source/bf:code"><transform><xsl:value-of select="bf:Source/bf:code"/></transform></case>
                        <case test="$vSourceUri != ''">
                          <switch>
                            <case test="contains($vSourceUri,'id.loc.gov')">
                              <transform>
                                <xsl:call-template name="tUriCode">
                                  <xsl:with-param name="pUri" select="$vSourceUri"/>
                                </xsl:call-template>
                              </transform>
                            </case>
                            <case test="default"><transform><xsl:value-of select="$vSourceUri"/></transform></case>
                          </switch>
                        </case>
                        <case test="default"><transform><xsl:value-of select="bf:Source/rdfs:label"/></transform></case>
                      </switch>
                    </sf>
                  </case>
                </switch>
              </select>
            </df>
          </case>

          <!-- 611 -->
          <case test="*[(local-name()='ConferenceName' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#ConferenceName'] or
                      local-name()='Meeting' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Meeting'] or
                      local-name(madsrdf:componentList/*[1])='ConferenceName' or madsrdf:componentList/*[1]/rdf:type/@rdf:resource='http://www.loc.gov/mads/rdf/v1#ConferenceName' or
                      local-name(madsrdf:componentList/*[1])='Meeting' or madsrdf:componentList/*[1]/rdf:type/@rdf:resource='http://id.loc.gov/ontologies/bibframe/Meeting' or
                      bf:contribution/*/bf:agent/*[local-name()='ConferenceName' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#ConferenceName'] or local-name()='Meeting' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Meeting']] or
                      madsrdf:componentList/*[1]/bf:contribution/*/bf:agent/*[local-name()='ConferenceName' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#ConferenceName'] or local-name()='Meeting' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Meeting']]) and
                      (madsrdf:componentList or madsrdf:authoritativeLabel)]">
            <df tag="611">
              <ind1 default="2"/>
              <ind2 default="4">
                <switch>
                  <case test="*/bf:source/bf:Source/bf:code='lcsh' or
                              */bf:source[@rdf:resource='http://id.loc.gov/authorities/subjects' or */@rdf:about='http://id.loc.gov/authorities/subjects'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='lcsh'">0</case>
                  <case test="*/bf:source/bf:Source/bf:code='lcshac' or
                              */bf:source[@rdf:resource='http://id.loc.gov/authorities/childrensSubjects' or */@rdf:about='http://id.loc.gov/authorities/childrensSubjects'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='lcshac'">1</case>
                  <case test="*/bf:source/bf:Source/bf:code='mesh' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/mesh' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/mesh'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='mesh'">2</case>
                  <case test="*/bf:source/bf:Source/bf:code='nal' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/nal' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/nal'] or
                              */madsrdf:componentList/*[1]/*/bf:source/bf:Source/bf:code='nal'">3</case>
                  <case test="*/bf:source/bf:Source/bf:code='cash' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/cash' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/cash'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='cash'">5</case>
                  <case test="*/bf:source/bf:Source/bf:code='rvm' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/rvm' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/rvm'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='rvm'">6</case>
                  <case test="*/bf:source or */madsrdf:componentList/*[1]/bf:source">7</case>
                </switch>
              </ind2>
              <sf code="3" repeatable="false">
                <select xpath="*/bflc:appliesTo/bflc:AppliesTo/rdfs:label"/>
              </sf>

              <!-- name subfields -->
              <select xpath="*[local-name()='ConferenceName' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#ConferenceName'] or local-name()='Meeting' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Meeting']] |
                             */madsrdf:componentList/*[1] |
                             bf:Work/bf:contribution/*/bf:agent/* |
                             */madsrdf:componentList/*[1]/bf:Work/bf:contribution/*/bf:agent/*">
                <sf code="a" chopPunct="true" repeatable="false">
                  <switch>
                    <case test="madsrdf:elementList">
                      <select xpath="madsrdf:elementList/*[1]/madsrdf:elementValue"/>
                    </case>
                    <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                    <case test="default"><select xpath="rdfs:label"/></case>
                  </switch>
                </sf>
                <sf code="c" chopPunct="true">
                  <select xpath="madsrdf:elementList/*[local-name()='GeographicElement' and position() &gt; 1]/madsrdf:elementValue"/>
                </sf>
                <sf code="q" chopPunct="true">
                  <select xpath="madsrdf:elementList/*[local-name()='NameElement' and position() &gt; 1]/madsrdf:elementValue"/>
                </sf>
                <sf code="j" chopPunct="true">
                  <select xpath="../../bf:role/*[rdfs:label or madsrdf:authoritativeLabel]">
                    <switch>
                      <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                      <case test="default"><select xpath="rdfs:label"/></case>
                    </switch>
                  </select>
                </sf>
                <!-- nac $u -->
                <sf code="4">
                  <select xpath="../../bf:role/*[madsrdf:code or bf:code]">
                    <switch>
                      <case test="madsrdf:code">
                        <select xpath="madsrdf:code"/>
                      </case>
                      <case test="default"><select xpath="bf:code"/></case>
                    </switch>
                  </select>
                </sf>
                <sf code="4">
                  <select xpath="../../bf:role/bf:Role/@rdf:about|../../bf:role/@rdf:resource"/>
                </sf>
                <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
                <sf code="0">
                  <select xpath="bf:identifiedBy/bf:Identifier">
                    <transform>
                      <xsl:variable name="vIdType">
                        <xsl:call-template name="tChopPunct">
                          <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                        </xsl:call-template>
                      </xsl:variable>
                      <xsl:choose>
                        <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                        <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                      </xsl:choose>
                    </transform>
                  </select>
                </sf>
              </select>

              <!-- title subfields -->
              <select xpath="bf:Work">
                <sf code="t" chopPunct="true" repeatable="false">
                  <select xpath="bf:title/bf:Title[not(contains(rdf:type/@rdf:resource,'bibframe'))]">
                    <switch>
                      <case test="bf:mainTitle"><select xpath="bf:mainTitle"/></case>
                      <case test="default"><select xpath="rdfs:label"/></case>
                    </switch>
                  </select>
                </sf>
                <sf code="d" chopPunct="true"><select xpath="bf:legalDate"/></sf>
                <sf code="f" chopPunct="true" repeatable="false"><select xpath="bf:originDate"/></sf>
                <sf code="l" chopPunct="true" repeatable="false">
                  <select xpath="bf:language/*/rdfs:label|bf:language/*/madsrdf:authoritativeLabel"/>
                </sf>
                <sf code="m" chopPunct="true"><select xpath="bf:musicMedium/bf:MusicMedium/rdfs:label"/></sf>
                <sf code="n" chopPunct="true"><select xpath="bf:title/bf:Title[not(contains(rdf:type/@rdf:resource,'bibframe'))][1]/bf:partNumber"/></sf>
                <sf code="p" chopPunct="true"><select xpath="bf:title/bf:Title[not(contains(rdf:type/@rdf:resource,'bibframe'))][1]/bf:partName"/></sf>
                <sf code="r" chopPunct="true" repeatable="false"><select xpath="bf:musicKey"/></sf>
                <sf code="s" chopPunct="true"><select xpath="bf:version"/></sf>
                <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
                <sf code="0">
                  <select xpath="bf:identifiedBy/bf:Identifier">
                    <transform>
                      <xsl:variable name="vIdType">
                        <xsl:call-template name="tChopPunct">
                          <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                        </xsl:call-template>
                      </xsl:variable>
                      <xsl:choose>
                        <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                        <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                      </xsl:choose>
                    </transform>
                  </select>
                </sf>
              </select>

              <!-- subdivisions -->
              <select xpath="*/madsrdf:componentList/*">
                <switch>
                  <case test="position() &gt; 1">
                    <switch>
                      <case test="local-name()='GenreForm' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#GenreForm']">
                        <sf code="v" chopPunct="true">
                          <switch>
                            <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                            <case test="default"><select xpath="rdfs:label"/></case>
                          </switch>
                        </sf>
                      </case>
                      <case test="local-name()='Temporal' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Temporal']">
                        <sf code="y" chopPunct="true">
                          <switch>
                            <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                            <case test="default"><select xpath="rdfs:label"/></case>
                          </switch>
                        </sf>
                      </case>
                      <case test="local-name()='Geographic' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Geographic']">
                        <sf code="z" chopPunct="true">
                          <switch>
                            <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                            <case test="default"><select xpath="rdfs:label"/></case>
                          </switch>
                        </sf>
                      </case>
                      <case test="default">
                        <sf code="x" chopPunct="true">
                          <switch>
                            <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                            <case test="default"><select xpath="rdfs:label"/></case>
                          </switch>
                        </sf>
                      </case>
                    </switch>
                    <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
                    <sf code="0">
                      <select xpath="bf:identifiedBy/bf:Identifier">
                        <transform>
                          <xsl:variable name="vIdType">
                            <xsl:call-template name="tChopPunct">
                              <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                            </xsl:call-template>
                          </xsl:variable>
                          <xsl:choose>
                            <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                            <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                          </xsl:choose>
                        </transform>
                      </select>
                    </sf>
                  </case>
                </switch>
              </select>

              <!-- $2 if source not in ind2 -->
              <select xpath="*/bf:source|*/madsrdf:componentList/*[1]/bf:source">
                <var name="vSourceUri">
                  <switch>
                    <case test="@rdf:resource"><transform><xsl:value-of select="@rdf:resource"/></transform></case>
                    <case test="*/@rdf:about"><transform><xsl:value-of select="*/@rdf:about"/></transform></case>
                  </switch>
                </var>
                <switch>
                  <case test="$vSourceUri != 'http://id.loc.gov/authorities/subjects' and
                              bf:Source/bf:code != 'lcsh' and
                              $vSourceUri != 'http://id.loc.gov/authorities/childrensSubjects' and
                              bf:Source/bf:code != 'lcshac' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/mesh' and
                              bf:Source/bf:code != 'mesh' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/nal' and
                              bf:Source/bf:code != 'nal' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/cash' and
                              bf:Source/bf:code != 'cash' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/rvm' and
                              bf:Source/bf:code != 'rvm'">
                    <sf code="2">
                      <switch>
                        <case test="bf:Source/bf:code"><transform><xsl:value-of select="bf:Source/bf:code"/></transform></case>
                        <case test="$vSourceUri != ''">
                          <switch>
                            <case test="contains($vSourceUri,'id.loc.gov')">
                              <transform>
                                <xsl:call-template name="tUriCode">
                                  <xsl:with-param name="pUri" select="$vSourceUri"/>
                                </xsl:call-template>
                              </transform>
                            </case>
                            <case test="default"><transform><xsl:value-of select="$vSourceUri"/></transform></case>
                          </switch>
                        </case>
                        <case test="default"><transform><xsl:value-of select="bf:Source/rdfs:label"/></transform></case>
                      </switch>
                    </sf>
                  </case>
                </switch>
              </select>
            </df>
          </case>

          <!-- 630 -->
          <case test="*[(local-name()='Work' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Work'] or
                      local-name(madsrdf:componentList/*[1])='Work' or madsrdf:componentList/*[1]/rdf:type/@rdf:resource='http://id.loc.gov/ontologies/bibframe/Work') and
                      (madsrdf:componentList or madsrdf:authoritativeLabel)]">
            <df tag="630">
              <ind1 default="0">
                <select xpath="*/bf:title/bf:Title[not(contains(rdf:type/@rdf:resource,'bibframe'))][1]|*/madsrdf:componentList/*[1]/bf:title/bf:Title[not(contains(rdf:type/@rdf:resource,'bibframe'))][1]">
                  <switch>
                    <case test="bflc:titleSortKey and (string-length(bflc:titleSortKey) &lt; string-length(rdfs:label))">
                      <transform>
                        <xsl:value-of select="string-length(rdfs:label) - string-length(bflc:titleSortKey)"/>
                      </transform>
                    </case>
                  </switch>
                </select>
              </ind1>
              <ind2 default="4">
                <switch>
                  <case test="*/bf:source/bf:Source/bf:code='lcsh' or
                              */bf:source[@rdf:resource='http://id.loc.gov/authorities/subjects' or */@rdf:about='http://id.loc.gov/authorities/subjects'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='lcsh'">0</case>
                  <case test="*/bf:source/bf:Source/bf:code='lcshac' or
                              */bf:source[@rdf:resource='http://id.loc.gov/authorities/childrensSubjects' or */@rdf:about='http://id.loc.gov/authorities/childrensSubjects'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='lcshac'">1</case>
                  <case test="*/bf:source/bf:Source/bf:code='mesh' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/mesh' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/mesh'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='mesh'">2</case>
                  <case test="*/bf:source/bf:Source/bf:code='nal' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/nal' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/nal'] or
                              */madsrdf:componentList/*[1]/*/bf:source/bf:Source/bf:code='nal'">3</case>
                  <case test="*/bf:source/bf:Source/bf:code='cash' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/cash' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/cash'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='cash'">5</case>
                  <case test="*/bf:source/bf:Source/bf:code='rvm' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/rvm' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/rvm'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='rvm'">6</case>
                  <case test="*/bf:source or */madsrdf:componentList/*[1]/bf:source">7</case>
                </switch>
              </ind2>
              <sf code="3" chopPunct="true" repeatable="false">
                <select xpath="*/bflc:appliesTo/bflc:AppliesTo/rdfs:label"/>
              </sf>
              <switch>
                <case test="*/madsrdf:componentList">
                  <sf code="0"><select xpath="*/@rdf:about[not(contains(.,'example.org'))]"/></sf>
                  <sf code="0">
                    <select xpath="*/bf:identifiedBy/bf:Identifier">
                      <transform>
                        <xsl:variable name="vIdType">
                          <xsl:call-template name="tChopPunct">
                            <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                          </xsl:call-template>
                        </xsl:variable>
                        <xsl:choose>
                          <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                          <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                        </xsl:choose>
                      </transform>
                    </select>
                  </sf>
                </case>
              </switch>
              <select xpath="*[local-name()='Work' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Work']] |
                             */madsrdf:componentList/*[1]">
                <sf code="a" chopPunct="true" repeatable="false">
                  <select xpath="bf:title/bf:Title[not(contains(rdf:type/@rdf:resource,'bibframe'))]">
                    <switch>
                      <case test="bf:mainTitle"><select xpath="bf:mainTitle"/></case>
                      <case test="default"><select xpath="rdfs:label"/></case>
                    </switch>
                  </select>
                </sf>
                <sf code="d" chopPunct="true"><select xpath="bf:legalDate"/></sf>
                <sf code="f" chopPunct="true" repeatable="false"><select xpath="bf:originDate"/></sf>
                <sf code="l" chopPunct="true" repeatable="false">
                  <select xpath="bf:language/*/rdfs:label|bf:language/*/madsrdf:authoritativeLabel"/>
                </sf>
                <sf code="m" chopPunct="true"><select xpath="bf:musicMedium/bf:MusicMedium/rdfs:label"/></sf>
                <sf code="n" chopPunct="true"><select xpath="bf:title/bf:Title[not(contains(rdf:type/@rdf:resource,'bibframe'))][1]/bf:partNumber"/></sf>
                <sf code="p" chopPunct="true"><select xpath="bf:title/bf:Title[not(contains(rdf:type/@rdf:resource,'bibframe'))][1]/bf:partName"/></sf>
                <sf code="r" chopPunct="true" repeatable="false"><select xpath="bf:musicKey"/></sf>
                <sf code="s" chopPunct="true"><select xpath="bf:version"/></sf>
                <switch>
                  <case test="not(ancestor::bf:subject/*/madsrdf:componentList)">
                    <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
                    <sf code="0">
                      <select xpath="bf:identifiedBy/bf:Identifier">
                        <transform>
                          <xsl:variable name="vIdType">
                            <xsl:call-template name="tChopPunct">
                              <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                            </xsl:call-template>
                          </xsl:variable>
                          <xsl:choose>
                            <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                            <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                          </xsl:choose>
                        </transform>
                      </select>
                    </sf>
                  </case>
                </switch>
                <sf code="e" chopPunct="true">
                  <select xpath="bflc:relationship/bflc:Relationship/bflc:relation/bflc:Relation/rdfs:label"/>
                </sf>
              </select>
              <!-- subdivisions -->
              <select xpath="*/madsrdf:componentList/*">
                <switch>
                  <case test="position() &gt; 1">
                    <switch>
                      <case test="local-name()='GenreForm' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#GenreForm']">
                        <sf code="v" chopPunct="true">
                          <switch>
                            <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                            <case test="default"><select xpath="rdfs:label"/></case>
                          </switch>
                        </sf>
                      </case>
                      <case test="local-name()='Temporal' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Temporal']">
                        <sf code="y" chopPunct="true">
                          <switch>
                            <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                            <case test="default"><select xpath="rdfs:label"/></case>
                          </switch>
                        </sf>
                      </case>
                      <case test="local-name()='Geographic' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Geographic']">
                        <sf code="z" chopPunct="true">
                          <switch>
                            <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                            <case test="default"><select xpath="rdfs:label"/></case>
                          </switch>
                        </sf>
                      </case>
                      <case test="default">
                        <sf code="x" chopPunct="true">
                          <switch>
                            <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                            <case test="default"><select xpath="rdfs:label"/></case>
                          </switch>
                        </sf>
                      </case>
                    </switch>
                    <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
                    <sf code="0">
                      <select xpath="bf:identifiedBy/bf:Identifier">
                        <transform>
                          <xsl:variable name="vIdType">
                            <xsl:call-template name="tChopPunct">
                              <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                            </xsl:call-template>
                          </xsl:variable>
                          <xsl:choose>
                            <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                            <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                          </xsl:choose>
                        </transform>
                      </select>
                    </sf>
                  </case>
                </switch>
              </select>

              <!-- $2 if source not in ind2 -->
              <select xpath="*/bf:source|*/madsrdf:componentList/*[1]/bf:source">
                <var name="vSourceUri">
                  <switch>
                    <case test="@rdf:resource"><transform><xsl:value-of select="@rdf:resource"/></transform></case>
                    <case test="*/@rdf:about"><transform><xsl:value-of select="*/@rdf:about"/></transform></case>
                  </switch>
                </var>
                <switch>
                  <case test="$vSourceUri != 'http://id.loc.gov/authorities/subjects' and
                              bf:Source/bf:code != 'lcsh' and
                              $vSourceUri != 'http://id.loc.gov/authorities/childrensSubjects' and
                              bf:Source/bf:code != 'lcshac' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/mesh' and
                              bf:Source/bf:code != 'mesh' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/nal' and
                              bf:Source/bf:code != 'nal' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/cash' and
                              bf:Source/bf:code != 'cash' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/rvm' and
                              bf:Source/bf:code != 'rvm'">
                    <sf code="2">
                      <switch>
                        <case test="bf:Source/bf:code"><transform><xsl:value-of select="bf:Source/bf:code"/></transform></case>
                        <case test="$vSourceUri != ''">
                          <switch>
                            <case test="contains($vSourceUri,'id.loc.gov')">
                              <transform>
                                <xsl:call-template name="tUriCode">
                                  <xsl:with-param name="pUri" select="$vSourceUri"/>
                                </xsl:call-template>
                              </transform>
                            </case>
                            <case test="default"><transform><xsl:value-of select="$vSourceUri"/></transform></case>
                          </switch>
                        </case>
                        <case test="default"><transform><xsl:value-of select="bf:Source/rdfs:label"/></transform></case>
                      </switch>
                    </sf>
                  </case>
                </switch>
              </select>
            </df>
          </case>

          <!-- 648 -->
          <case test="*[(local-name()='Temporal' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Temporal'] or
                      local-name()='Temporal' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Temporal'] or
                      local-name(madsrdf:componentList/*[1])='Temporal' or madsrdf:componentList/*[1]/rdf:type/@rdf:resource='http://www.loc.gov/mads/rdf/v1#Temporal' or
                      local-name(madsrdf:componentList/*[1])='Temporal' or madsrdf:componentList/*[1]/rdf:type/@rdf:resource='http://id.loc.gov/ontologies/bibframe/Temporal') and
                      (madsrdf:componentList or madsrdf:authoritativeLabel)]">
            <df tag="648">
              <ind1 default=" "/>
              <ind2 default="4">
                <switch>
                  <case test="*/bf:source/bf:Source/bf:code='lcsh' or
                              */bf:source[@rdf:resource='http://id.loc.gov/authorities/subjects' or */@rdf:about='http://id.loc.gov/authorities/subjects'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='lcsh'">0</case>
                  <case test="*/bf:source/bf:Source/bf:code='lcshac' or
                              */bf:source[@rdf:resource='http://id.loc.gov/authorities/childrensSubjects' or */@rdf:about='http://id.loc.gov/authorities/childrensSubjects'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='lcshac'">1</case>
                  <case test="*/bf:source/bf:Source/bf:code='mesh' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/mesh' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/mesh'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='mesh'">2</case>
                  <case test="*/bf:source/bf:Source/bf:code='nal' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/nal' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/nal'] or
                              */madsrdf:componentList/*[1]/*/bf:source/bf:Source/bf:code='nal'">3</case>
                  <case test="*/bf:source/bf:Source/bf:code='cash' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/cash' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/cash'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='cash'">5</case>
                  <case test="*/bf:source/bf:Source/bf:code='rvm' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/rvm' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/rvm'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='rvm'">6</case>
                  <case test="*/bf:source or */madsrdf:componentList/*[1]/bf:source">7</case>
                </switch>
              </ind2>
              <switch>
                <case test="*/madsrdf:componentList">
                  <sf code="0"><select xpath="*/@rdf:about[not(contains(.,'example.org'))]"/></sf>
                  <sf code="0">
                    <select xpath="*/bf:identifiedBy/bf:Identifier">
                      <transform>
                        <xsl:variable name="vIdType">
                          <xsl:call-template name="tChopPunct">
                            <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                          </xsl:call-template>
                        </xsl:variable>
                        <xsl:choose>
                          <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                          <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                        </xsl:choose>
                      </transform>
                    </select>
                  </sf>
                  <sf code="3" chopPunct="true" repeatable="false">
                    <select xpath="*/bflc:appliesTo/bflc:AppliesTo/rdfs:label"/>
                  </sf>
                  <sf code="a" chopPunct="true" repeatable="false">
                    <switch>
                      <case test="*/madsrdf:componentList/*[1]/madsrdf:authoritativeLabel"><select xpath="*/madsrdf:componentList/*[1]/madsrdf:authoritativeLabel"/></case>
                      <case test="default"><select xpath="*/madsrdf:componentList/*[1]/rdfs:label"/></case>
                    </switch>
                  </sf>
                  <sf code="0"><select xpath="madsrdf:componentList/*[1]/@rdf:about[not(contains(.,'example.org'))]"/></sf>
                  <sf code="0">
                    <select xpath="bf:identifiedBy/bf:Identifier">
                      <transform>
                        <xsl:variable name="vIdType">
                          <xsl:call-template name="tChopPunct">
                            <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                          </xsl:call-template>
                        </xsl:variable>
                        <xsl:choose>
                          <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                          <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                        </xsl:choose>
                      </transform>
                    </select>
                  </sf>

                  <!-- subdivisions -->
                  <select xpath="*/madsrdf:componentList/*">
                    <switch>
                      <case test="position() &gt; 1">
                        <switch>
                          <case test="local-name()='GenreForm' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#GenreForm']">
                            <sf code="v" chopPunct="true">
                              <switch>
                                <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                                <case test="default"><select xpath="rdfs:label"/></case>
                              </switch>
                            </sf>
                          </case>
                          <case test="local-name()='Temporal' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Temporal']">
                            <sf code="y" chopPunct="true">
                              <switch>
                                <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                                <case test="default"><select xpath="rdfs:label"/></case>
                              </switch>
                            </sf>
                          </case>
                          <case test="local-name()='Geographic' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Geographic']">
                            <sf code="z" chopPunct="true">
                              <switch>
                                <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                                <case test="default"><select xpath="rdfs:label"/></case>
                              </switch>
                            </sf>
                          </case>
                          <case test="default">
                            <sf code="x" chopPunct="true">
                              <switch>
                                <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                                <case test="default"><select xpath="rdfs:label"/></case>
                              </switch>
                            </sf>
                          </case>
                        </switch>
                        <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
                        <sf code="0">
                          <select xpath="bf:identifiedBy/bf:Identifier">
                            <transform>
                              <xsl:variable name="vIdType">
                                <xsl:call-template name="tChopPunct">
                                  <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                                </xsl:call-template>
                              </xsl:variable>
                              <xsl:choose>
                                <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                                <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                              </xsl:choose>
                            </transform>
                          </select>
                        </sf>
                      </case>
                    </switch>
                  </select>
                </case>
                <case test="default">
                  <sf code="3" chopPunct="true" repeatable="false">
                    <select xpath="*/bflc:appliesTo/bflc:AppliesTo/rdfs:label"/>
                  </sf>
                  <sf code="a" chopPunct="true" repeatable="false">
                    <switch>
                      <case test="*/madsrdf:authoritativeLabel">
                        <select xpath="*/madsrdf:authoritativeLabel[1]"/>
                      </case>
                      <case test="default"><select xpath="*/rdfs:label[1]"/></case>
                    </switch>
                  </sf>
                  <sf code="0"><select xpath="*/@rdf:about[not(contains(.,'example.org'))]"/></sf>
                  <sf code="0">
                    <select xpath="*/bf:identifiedBy/bf:Identifier">
                      <transform>
                        <xsl:variable name="vIdType">
                          <xsl:call-template name="tChopPunct">
                            <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                          </xsl:call-template>
                        </xsl:variable>
                        <xsl:choose>
                          <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                          <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                        </xsl:choose>
                      </transform>
                    </select>
                  </sf>
                </case>
              </switch>
              <!-- $2 if source not in ind2 -->
              <select xpath="*/bf:source|*/madsrdf:componentList/*[1]/bf:source">
                <var name="vSourceUri">
                  <switch>
                    <case test="@rdf:resource"><transform><xsl:value-of select="@rdf:resource"/></transform></case>
                    <case test="*/@rdf:about"><transform><xsl:value-of select="*/@rdf:about"/></transform></case>
                  </switch>
                </var>
                <switch>
                  <case test="$vSourceUri != 'http://id.loc.gov/authorities/subjects' and
                              bf:Source/bf:code != 'lcsh' and
                              $vSourceUri != 'http://id.loc.gov/authorities/childrensSubjects' and
                              bf:Source/bf:code != 'lcshac' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/mesh' and
                              bf:Source/bf:code != 'mesh' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/nal' and
                              bf:Source/bf:code != 'nal' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/cash' and
                              bf:Source/bf:code != 'cash' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/rvm' and
                              bf:Source/bf:code != 'rvm'">
                    <sf code="2">
                      <switch>
                        <case test="bf:Source/bf:code"><transform><xsl:value-of select="bf:Source/bf:code"/></transform></case>
                        <case test="$vSourceUri != ''">
                          <switch>
                            <case test="contains($vSourceUri,'id.loc.gov')">
                              <transform>
                                <xsl:call-template name="tUriCode">
                                  <xsl:with-param name="pUri" select="$vSourceUri"/>
                                </xsl:call-template>
                              </transform>
                            </case>
                            <case test="default"><transform><xsl:value-of select="$vSourceUri"/></transform></case>
                          </switch>
                        </case>
                        <case test="default"><transform><xsl:value-of select="bf:Source/rdfs:label"/></transform></case>
                      </switch>
                    </sf>
                  </case>
                </switch>
              </select>
            </df>
          </case>

          <!-- 662 -->
          <case test="*[local-name()='HierarchicalGeographic' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#HierarchicalGeographic']]">
            <df tag="662">
              <ind1 default=" "/>
              <ind2 default=" "/>
              <sf code="0"><select xpath="*/@rdf:about[not(contains(.,'example.org'))]"/></sf>
              <sf code="0">
                <select xpath="*/bf:identifiedBy/bf:Identifier">
                  <transform>
                    <xsl:variable name="vIdType">
                      <xsl:call-template name="tChopPunct">
                        <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                      </xsl:call-template>
                    </xsl:variable>
                    <xsl:choose>
                      <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                      <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                    </xsl:choose>
                  </transform>
                </select>
              </sf>
              <select xpath="*/madsrdf:componentList/*">
                <switch>
                  <case test="local-name()='Country' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Country']">
                    <sf code="a" chopPunct="true">
                      <switch>
                        <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                        <case test="default"><select xpath="rdfs:label"/></case>
                      </switch>
                    </sf>
                  </case>
                  <case test="local-name()='State' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#State']">
                    <sf code="b" chopPunct="true">
                      <switch>
                        <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                        <case test="default"><select xpath="rdfs:label"/></case>
                      </switch>
                    </sf>
                  </case>
                  <case test="local-name()='County' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#County']">
                    <sf code="c" chopPunct="true">
                      <switch>
                        <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                        <case test="default"><select xpath="rdfs:label"/></case>
                      </switch>
                    </sf>
                  </case>
                  <case test="local-name()='City' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#City']">
                    <sf code="d" chopPunct="true">
                      <switch>
                        <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                        <case test="default"><select xpath="rdfs:label"/></case>
                      </switch>
                    </sf>
                  </case>
                  <case test="local-name()='CitySection' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#CitySection']">
                    <sf code="f" chopPunct="true">
                      <switch>
                        <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                        <case test="default"><select xpath="rdfs:label"/></case>
                      </switch>
                    </sf>
                  </case>
                  <case test="local-name()='Region' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Region']">
                    <sf code="g" chopPunct="true">
                      <switch>
                        <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                        <case test="default"><select xpath="rdfs:label"/></case>
                      </switch>
                    </sf>
                  </case>
                  <case test="local-name()='ExtraterrestrialArea' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#ExtraterrestrialArea']">
                    <sf code="h" chopPunct="true">
                      <switch>
                        <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                        <case test="default"><select xpath="rdfs:label"/></case>
                      </switch>
                    </sf>
                  </case>
                </switch>
                <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
                <sf code="0">
                  <select xpath="bf:identifiedBy/bf:Identifier">
                    <transform>
                      <xsl:variable name="vIdType">
                        <xsl:call-template name="tChopPunct">
                          <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                        </xsl:call-template>
                      </xsl:variable>
                      <xsl:choose>
                        <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                        <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                      </xsl:choose>
                    </transform>
                  </select>
                </sf>
              </select>
              <sf code="e" chopPunct="true">
                <select xpath="*/bf:role/bf:Role/rdfs:label"/>
              </sf>
              <sf code="2" repeatable="false">
                <select xpath="*/bf:source | */madsrdf:componentList/*[1]/bf:source">
                  <var name="vSourceUri662">
                    <switch>
                      <case test="@rdf:resource"><transform><xsl:value-of select="@rdf:resource"/></transform></case>
                      <case test="*/@rdf:about"><transform><xsl:value-of select="*/@rdf:about"/></transform></case>
                    </switch>
                  </var>
                  <switch>
                    <case test="*/*[local-name()='code']">
                      <transform><xsl:value-of select="*/*[local-name()='code']"/></transform>
                    </case>
                    <case test="$vSourceUri662 != ''">
                      <switch>
                        <case test="contains($vSourceUri662,'id.loc.gov')">
                          <transform>
                            <xsl:call-template name="tUriCode">
                              <xsl:with-param name="pUri" select="$vSourceUri662"/>
                            </xsl:call-template>
                          </transform>
                        </case>
                        <case test="default"><transform><xsl:value-of select="$vSourceUri662"/></transform></case>
                      </switch>
                    </case>
                    <case test="*/madsrdf:authoritativeLabel">
                      <transform><xsl:value-of select="*/madsrdf:authoritativeLabel"/></transform>
                    </case>
                    <case test="default">
                      <transform><xsl:value-of select="*/rdfs:label"/></transform>
                    </case>
                  </switch>
                </select>
              </sf>
            </df>
          </case>

          <!-- all other places are 651s -->
          <case test="*[(local-name()='Geographic' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Geographic'] or
                      local-name()='Place' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Place'] or
                      local-name(madsrdf:componentList/*[1])='Geographic' or madsrdf:componentList/*[1]/rdf:type/@rdf:resource='http://www.loc.gov/mads/rdf/v1#Geographic' or
                      local-name(madsrdf:componentList/*[1])='Place' or madsrdf:componentList/*[1]/rdf:type/@rdf:resource='http://id.loc.gov/ontologies/bibframe/Place') and
                      (madsrdf:componentList or madsrdf:authoritativeLabel)]">
            <df tag="651">
              <ind1 default=" "/>
              <ind2 default="4">
                <switch>
                  <case test="*/bf:source/bf:Source/bf:code='lcsh' or
                              */bf:source[@rdf:resource='http://id.loc.gov/authorities/subjects' or */@rdf:about='http://id.loc.gov/authorities/subjects'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='lcsh'">0</case>
                  <case test="*/bf:source/bf:Source/bf:code='lcshac' or
                              */bf:source[@rdf:resource='http://id.loc.gov/authorities/childrensSubjects' or */@rdf:about='http://id.loc.gov/authorities/childrensSubjects'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='lcshac'">1</case>
                  <case test="*/bf:source/bf:Source/bf:code='mesh' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/mesh' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/mesh'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='mesh'">2</case>
                  <case test="*/bf:source/bf:Source/bf:code='nal' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/nal' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/nal'] or
                              */madsrdf:componentList/*[1]/*/bf:source/bf:Source/bf:code='nal'">3</case>
                  <case test="*/bf:source/bf:Source/bf:code='cash' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/cash' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/cash'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='cash'">5</case>
                  <case test="*/bf:source/bf:Source/bf:code='rvm' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/rvm' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/rvm'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='rvm'">6</case>
                  <case test="*/bf:source or */madsrdf:componentList/*[1]/bf:source">7</case>
                </switch>
              </ind2>
              <switch>
                <case test="*/madsrdf:componentList">
                  <sf code="0"><select xpath="*/@rdf:about[not(contains(.,'example.org'))]"/></sf>
                  <sf code="0">
                    <select xpath="*/bf:identifiedBy/bf:Identifier">
                      <transform>
                        <xsl:variable name="vIdType">
                          <xsl:call-template name="tChopPunct">
                            <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                          </xsl:call-template>
                        </xsl:variable>
                        <xsl:choose>
                          <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                          <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                        </xsl:choose>
                      </transform>
                    </select>
                  </sf>
                  <sf code="3" chopPunct="true" repeatable="false">
                    <select xpath="*/bflc:appliesTo/bflc:AppliesTo/rdfs:label"/>
                  </sf>
                  <sf code="a" chopPunct="true" repeatable="false">
                    <switch>
                      <case test="*/madsrdf:componentList/*[1]/madsrdf:authoritativeLabel"><select xpath="*/madsrdf:componentList/*[1]/madsrdf:authoritativeLabel"/></case>
                      <case test="default"><select xpath="*/madsrdf:componentList/*[1]/rdfs:label"/></case>
                    </switch>
                  </sf>
                  <sf code="e" chopPunct="true">
                    <select xpath="*/bf:role/bf:Role/rdfs:label"/>
                  </sf>
                  <sf code="0"><select xpath="*/madsrdf:componentList/*[1]/@rdf:about[not(contains(.,'example.org'))]"/></sf>
                  <sf code="0">
                    <select xpath="*/madsrdf:componentList/*[1]/bf:identifiedBy/bf:Identifier">
                      <transform>
                        <xsl:variable name="vIdType">
                          <xsl:call-template name="tChopPunct">
                            <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                          </xsl:call-template>
                        </xsl:variable>
                        <xsl:choose>
                          <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                          <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                        </xsl:choose>
                      </transform>
                    </select>
                  </sf>
                  <!-- subdivisions -->
                  <select xpath="*/madsrdf:componentList/*">
                    <switch>
                      <case test="position() &gt; 1">
                        <switch>
                          <case test="local-name()='GenreForm' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#GenreForm']">
                            <sf code="v" chopPunct="true">
                              <switch>
                                <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                                <case test="default"><select xpath="rdfs:label"/></case>
                              </switch>
                            </sf>
                          </case>
                          <case test="local-name()='Temporal' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Temporal']">
                            <sf code="y" chopPunct="true">
                              <switch>
                                <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                                <case test="default"><select xpath="rdfs:label"/></case>
                              </switch>
                            </sf>
                          </case>
                          <case test="local-name()='Geographic' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Geographic']">
                            <sf code="z" chopPunct="true">
                              <switch>
                                <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                                <case test="default"><select xpath="rdfs:label"/></case>
                              </switch>
                            </sf>
                          </case>
                          <case test="default">
                            <sf code="x" chopPunct="true">
                              <switch>
                                <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                                <case test="default"><select xpath="rdfs:label"/></case>
                              </switch>
                            </sf>
                          </case>
                        </switch>
                        <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
                        <sf code="0">
                          <select xpath="bf:identifiedBy/bf:Identifier">
                            <transform>
                              <xsl:variable name="vIdType">
                                <xsl:call-template name="tChopPunct">
                                  <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                                </xsl:call-template>
                              </xsl:variable>
                              <xsl:choose>
                                <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                                <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                              </xsl:choose>
                            </transform>
                          </select>
                        </sf>
                      </case>
                    </switch>
                  </select>
                </case>
                <case test="default">
                  <sf code="3" chopPunct="true" repeatable="false">
                    <select xpath="*/bflc:appliesTo/bflc:AppliesTo/rdfs:label"/>
                  </sf>
                  <sf code="a" chopPunct="true" repeatable="false">
                    <switch>
                      <case test="*/madsrdf:authoritativeLabel">
                        <select xpath="*/madsrdf:authoritativeLabel[1]"/>
                      </case>
                      <case test="default"><select xpath="*/rdfs:label[1]"/></case>
                    </switch>
                  </sf>
                  <sf code="e" chopPunct="true">
                    <select xpath="*/bf:role/bf:Role/rdfs:label"/>
                  </sf>
                  <sf code="0"><select xpath="*/@rdf:about[not(contains(.,'example.org'))]"/></sf>
                  <sf code="0">
                    <select xpath="*/bf:identifiedBy/bf:Identifier">
                      <transform>
                        <xsl:variable name="vIdType">
                          <xsl:call-template name="tChopPunct">
                            <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                          </xsl:call-template>
                        </xsl:variable>
                        <xsl:choose>
                          <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                          <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                        </xsl:choose>
                      </transform>
                    </select>
                  </sf>
                </case>
              </switch>
              <sf code="e" chopPunct="true">
                <select xpath="*/bflc:relationship/bflc:Relationship/bflc:relation/bflc:Relation/rdfs:label"/>
              </sf>
              <!-- $2 if source not in ind2 -->
              <select xpath="*/bf:source|*/madsrdf:componentList/*[1]/bf:source">
                <var name="vSourceUri">
                  <switch>
                    <case test="@rdf:resource"><transform><xsl:value-of select="@rdf:resource"/></transform></case>
                    <case test="*/@rdf:about"><transform><xsl:value-of select="*/@rdf:about"/></transform></case>
                  </switch>
                </var>
                <switch>
                  <case test="$vSourceUri != 'http://id.loc.gov/authorities/subjects' and
                              bf:Source/bf:code != 'lcsh' and
                              $vSourceUri != 'http://id.loc.gov/authorities/childrensSubjects' and
                              bf:Source/bf:code != 'lcshac' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/mesh' and
                              bf:Source/bf:code != 'mesh' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/nal' and
                              bf:Source/bf:code != 'nal' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/cash' and
                              bf:Source/bf:code != 'cash' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/rvm' and
                              bf:Source/bf:code != 'rvm'">
                    <sf code="2">
                      <switch>
                        <case test="bf:Source/bf:code"><transform><xsl:value-of select="bf:Source/bf:code"/></transform></case>
                        <case test="$vSourceUri != ''">
                          <switch>
                            <case test="contains($vSourceUri,'id.loc.gov')">
                              <transform>
                                <xsl:call-template name="tUriCode">
                                  <xsl:with-param name="pUri" select="$vSourceUri"/>
                                </xsl:call-template>
                              </transform>
                            </case>
                            <case test="default"><transform><xsl:value-of select="$vSourceUri"/></transform></case>
                          </switch>
                        </case>
                        <case test="default"><transform><xsl:value-of select="bf:Source/rdfs:label"/></transform></case>
                      </switch>
                    </sf>
                  </case>
                </switch>
              </select>
            </df>
          </case>

          <!-- 656 -->
          <case test="*[(local-name()='Occupation' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Occupation'] or
                      local-name(madsrdf:componentList/*[1])='Occupation' or madsrdf:componentList/*[1]/rdf:type/@rdf:resource='http://www.loc.gov/mads/rdf/v1#Occupation') and
                      (madsrdf:componentList or madsrdf:authoritativeLabel) and
                      bf:source]">
            <df tag="656">
              <ind1 default=" "/>
              <ind2 default="7"/>
              <switch>
                <case test="*/madsrdf:componentList">
                  <sf code="0"><select xpath="*/@rdf:about[not(contains(.,'example.org'))]"/></sf>
                  <sf code="0">
                    <select xpath="*/bf:identifiedBy/bf:Identifier">
                      <transform>
                        <xsl:variable name="vIdType">
                          <xsl:call-template name="tChopPunct">
                            <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                          </xsl:call-template>
                        </xsl:variable>
                        <xsl:choose>
                          <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                          <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                        </xsl:choose>
                      </transform>
                    </select>
                  </sf>
                  <sf code="3" chopPunct="true" repeatable="false">
                    <select xpath="*/bflc:appliesTo/bflc:AppliesTo/rdfs:label"/>
                  </sf>
                  <sf code="a" chopPunct="true" repeatable="false">
                    <switch>
                      <case test="*/madsrdf:componentList/*[1]/madsrdf:authoritativeLabel"><select xpath="*/madsrdf:componentList/*[1]/madsrdf:authoritativeLabel"/></case>
                      <case test="default"><select xpath="*/madsrdf:componentList/*[1]/rdfs:label"/></case>
                    </switch>
                  </sf>
                  <sf code="0"><select xpath="madsrdf:componentList/*[1]/@rdf:about[not(contains(.,'example.org'))]"/></sf>
                  <sf code="0">
                    <select xpath="madsrdf:componentList/*[1]/bf:identifiedBy/bf:Identifier">
                      <transform>
                        <xsl:variable name="vIdType">
                          <xsl:call-template name="tChopPunct">
                            <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                          </xsl:call-template>
                        </xsl:variable>
                        <xsl:choose>
                          <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                          <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                        </xsl:choose>
                      </transform>
                    </select>
                  </sf>
                  <!-- subdivisions -->
                  <select xpath="*/madsrdf:componentList/*">
                    <switch>
                      <case test="position() &gt; 1">
                        <switch>
                          <case test="local-name()='GenreForm' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#GenreForm']">
                            <sf code="v" chopPunct="true">
                              <switch>
                                <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                                <case test="default"><select xpath="rdfs:label"/></case>
                              </switch>
                            </sf>
                          </case>
                          <case test="local-name()='Temporal' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Temporal']">
                            <sf code="y" chopPunct="true">
                              <switch>
                                <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                                <case test="default"><select xpath="rdfs:label"/></case>
                              </switch>
                            </sf>
                          </case>
                          <case test="local-name()='Geographic' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Geographic']">
                            <sf code="z" chopPunct="true">
                              <switch>
                                <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                                <case test="default"><select xpath="rdfs:label"/></case>
                              </switch>
                            </sf>
                          </case>
                          <case test="default">
                            <sf code="x" chopPunct="true">
                              <switch>
                                <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                                <case test="default"><select xpath="rdfs:label"/></case>
                              </switch>
                            </sf>
                          </case>
                        </switch>
                        <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
                        <sf code="0">
                          <select xpath="bf:identifiedBy/bf:Identifier">
                            <transform>
                              <xsl:variable name="vIdType">
                                <xsl:call-template name="tChopPunct">
                                  <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                                </xsl:call-template>
                              </xsl:variable>
                              <xsl:choose>
                                <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                                <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                              </xsl:choose>
                            </transform>
                          </select>
                        </sf>
                      </case>
                    </switch>
                  </select>
                </case>
                <case test="default">
                  <sf code="3" chopPunct="true" repeatable="false">
                    <select xpath="*/bflc:appliesTo/bflc:AppliesTo/rdfs:label"/>
                  </sf>
                  <sf code="a" chopPunct="true" repeatable="false">
                    <switch>
                      <case test="*/madsrdf:authoritativeLabel">
                        <select xpath="*/madsrdf:authoritativeLabel[1]"/>
                      </case>
                      <case test="default"><select xpath="*/rdfs:label[1]"/></case>
                    </switch>
                  </sf>
                  <sf code="0"><select xpath="*/@rdf:about[not(contains(.,'example.org'))]"/></sf>
                  <sf code="0">
                    <select xpath="*/bf:identifiedBy/bf:Identifier">
                      <transform>
                        <xsl:variable name="vIdType">
                          <xsl:call-template name="tChopPunct">
                            <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                          </xsl:call-template>
                        </xsl:variable>
                        <xsl:choose>
                          <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                          <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                        </xsl:choose>
                      </transform>
                    </select>
                  </sf>
                </case>
              </switch>
              <sf code="2" chopPunct="true" repeatable="false">
                <select xpath="*/bf:source/bf:Source/bf:code|*/madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code"/>
              </sf>
            </df>
          </case>

          <!-- all other authorized entries are 650s -->
          <case test="*[madsrdf:componentList or madsrdf:authoritativeLabel]">
            <df tag="650">
              <ind1 default=" "/>
              <ind2 default="4">
                <switch>
                  <case test="*/bf:source/bf:Source/bf:code='lcsh' or
                              */bf:source[@rdf:resource='http://id.loc.gov/authorities/subjects' or */@rdf:about='http://id.loc.gov/authorities/subjects'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='lcsh'">0</case>
                  <case test="*/bf:source/bf:Source/bf:code='lcshac' or
                              */bf:source[@rdf:resource='http://id.loc.gov/authorities/childrensSubjects' or */@rdf:about='http://id.loc.gov/authorities/childrensSubjects'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='lcshac'">1</case>
                  <case test="*/bf:source/bf:Source/bf:code='mesh' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/mesh' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/mesh'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='mesh'">2</case>
                  <case test="*/bf:source/bf:Source/bf:code='nal' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/nal' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/nal'] or
                              */madsrdf:componentList/*[1]/*/bf:source/bf:Source/bf:code='nal'">3</case>
                  <case test="*/bf:source/bf:Source/bf:code='cash' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/cash' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/cash'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='cash'">5</case>
                  <case test="*/bf:source/bf:Source/bf:code='rvm' or
                              */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/rvm' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/rvm'] or
                              */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='rvm'">6</case>
                  <case test="*/bf:source or */madsrdf:componentList/*[1]/bf:source">7</case>
                </switch>
              </ind2>
              <switch>
                <case test="*/madsrdf:componentList">
                  <sf code="0"><select xpath="*/@rdf:about[not(contains(.,'example.org'))]"/></sf>
                  <sf code="0">
                    <select xpath="*/bf:identifiedBy/bf:Identifier">
                      <transform>
                        <xsl:variable name="vIdType">
                          <xsl:call-template name="tChopPunct">
                            <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                          </xsl:call-template>
                        </xsl:variable>
                        <xsl:choose>
                          <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                          <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                        </xsl:choose>
                      </transform>
                    </select>
                  </sf>
                  <sf code="3" chopPunct="true" repeatable="false">
                    <select xpath="*/bflc:appliesTo/bflc:AppliesTo/rdfs:label"/>
                  </sf>
                  <sf code="a" chopPunct="true" repeatable="false">
                    <switch>
                      <case test="*/madsrdf:componentList/*[1]/madsrdf:authoritativeLabel"><select xpath="*/madsrdf:componentList/*[1]/madsrdf:authoritativeLabel"/></case>
                      <case test="default"><select xpath="*/madsrdf:componentList/*[1]/rdfs:label"/></case>
                    </switch>
                  </sf>
                  <sf code="e" chopPunct="true">
                    <select xpath="*/bf:role/bf:Role/rdfs:label"/>
                  </sf>
                  <sf code="0"><select xpath="*/madsrdf:componentList/*[1]/@rdf:about[not(contains(.,'example.org'))]"/></sf>
                  <sf code="0">
                    <select xpath="*/madsrdf:componentList/*[1]/bf:identifiedBy/bf:Identifier">
                      <transform>
                        <xsl:variable name="vIdType">
                          <xsl:call-template name="tChopPunct">
                            <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                          </xsl:call-template>
                        </xsl:variable>
                        <xsl:choose>
                          <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                          <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                        </xsl:choose>
                      </transform>
                    </select>
                  </sf>
                  <!-- subdivisions -->
                  <select xpath="*/madsrdf:componentList/*">
                    <switch>
                      <case test="position() &gt; 1">
                        <switch>
                          <case test="local-name()='GenreForm' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#GenreForm']">
                            <sf code="v" chopPunct="true">
                              <switch>
                                <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                                <case test="default"><select xpath="rdfs:label"/></case>
                              </switch>
                            </sf>
                          </case>
                          <case test="local-name()='Temporal' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Temporal']">
                            <sf code="y" chopPunct="true">
                              <switch>
                                <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                                <case test="default"><select xpath="rdfs:label"/></case>
                              </switch>
                            </sf>
                          </case>
                          <case test="local-name()='Geographic' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Geographic']">
                            <sf code="z" chopPunct="true">
                              <switch>
                                <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                                <case test="default"><select xpath="rdfs:label"/></case>
                              </switch>
                            </sf>
                          </case>
                          <case test="default">
                            <sf code="x" chopPunct="true">
                              <switch>
                                <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                                <case test="default"><select xpath="rdfs:label"/></case>
                              </switch>
                            </sf>
                          </case>
                        </switch>
                        <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
                        <sf code="0">
                          <select xpath="bf:identifiedBy/bf:Identifier">
                            <transform>
                              <xsl:variable name="vIdType">
                                <xsl:call-template name="tChopPunct">
                                  <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                                </xsl:call-template>
                              </xsl:variable>
                              <xsl:choose>
                                <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                                <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                              </xsl:choose>
                            </transform>
                          </select>
                        </sf>
                      </case>
                    </switch>
                  </select>
                </case>
                <case test="default">
                  <sf code="3" chopPunct="true" repeatable="false">
                    <select xpath="*/bflc:appliesTo/bflc:AppliesTo/rdfs:label"/>
                  </sf>
                  <sf code="a" chopPunct="true" repeatable="false">
                    <switch>
                      <case test="*/madsrdf:authoritativeLabel">
                        <select xpath="*/madsrdf:authoritativeLabel[1]"/>
                      </case>
                      <case test="default"><select xpath="*/rdfs:label[1]"/></case>
                    </switch>
                  </sf>
                  <sf code="e" chopPunct="true">
                    <select xpath="*/bf:role/bf:Role/rdfs:label"/>
                  </sf>
                  <sf code="0"><select xpath="*/@rdf:about[not(contains(.,'example.org'))]"/></sf>
                  <sf code="0">
                    <select xpath="*/bf:identifiedBy/bf:Identifier">
                      <transform>
                        <xsl:variable name="vIdType">
                          <xsl:call-template name="tChopPunct">
                            <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                          </xsl:call-template>
                        </xsl:variable>
                        <xsl:choose>
                          <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                          <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                        </xsl:choose>
                      </transform>
                    </select>
                  </sf>
                </case>
              </switch>
              <!-- $2 if source not in ind2 -->
              <select xpath="*/bf:source|*/madsrdf:componentList/*[1]/bf:source">
                <var name="vSourceUri">
                  <switch>
                    <case test="@rdf:resource"><transform><xsl:value-of select="@rdf:resource"/></transform></case>
                    <case test="*/@rdf:about"><transform><xsl:value-of select="*/@rdf:about"/></transform></case>
                  </switch>
                </var>
                <switch>
                  <case test="$vSourceUri != 'http://id.loc.gov/authorities/subjects' and
                              bf:Source/bf:code != 'lcsh' and
                              $vSourceUri != 'http://id.loc.gov/authorities/childrensSubjects' and
                              bf:Source/bf:code != 'lcshac' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/mesh' and
                              bf:Source/bf:code != 'mesh' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/nal' and
                              bf:Source/bf:code != 'nal' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/cash' and
                              bf:Source/bf:code != 'cash' and
                              $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/rvm' and
                              bf:Source/bf:code != 'rvm'">
                    <sf code="2">
                      <switch>
                        <case test="bf:Source/bf:code"><transform><xsl:value-of select="bf:Source/bf:code"/></transform></case>
                        <case test="$vSourceUri != ''">
                          <switch>
                            <case test="contains($vSourceUri,'id.loc.gov')">
                              <transform>
                                <xsl:call-template name="tUriCode">
                                  <xsl:with-param name="pUri" select="$vSourceUri"/>
                                </xsl:call-template>
                              </transform>
                            </case>
                            <case test="default"><transform><xsl:value-of select="$vSourceUri"/></transform></case>
                          </switch>
                        </case>
                        <case test="default"><transform><xsl:value-of select="bf:Source/rdfs:label"/></transform></case>
                      </switch>
                    </sf>
                  </case>
                </switch>
              </select>
            </df>
          </case>

          <!-- unauthorized terms are 653s -->
          <case test="default">
            <df tag="653">
              <ind1 default=" "/>
              <ind2 default=" ">
                <switch>
                  <case test="*[local-name() = 'Person' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Person']]">1</case>
                  <case test="*[local-name() = 'Organization' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Organization']]">2</case>
                  <case test="*[local-name() = 'Meeting' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Meeting']]">3</case>
                  <case test="*[local-name() = 'Temporal' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Temporal']]">4</case>
                  <case test="*[local-name() = 'Place' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Place']]">5</case>
                  <case test="*[local-name() = 'GenreForm' or rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/GenreForm']]">6</case>
                </switch>
              </ind2>
              <sf code="a" chopPunct="true">
                <select xpath="*/rdfs:label"/>
              </sf>
            </df>
          </case>
        </switch>
      </case>
    </switch>
  </select>

  <!-- genreForms -->
  <df tag="655" lang-xpath="*/rdfs:label" lang-prefer="tranliterated">
    <context xpath="bf:Work/bf:genreForm | //bf:Item/bf:genreForm">
      <ind1 default=" "/>
      <ind2 default="4">
        <switch>
          <case test="*/bf:source/bf:Source/bf:code='lcsh' or
                      */bf:source[@rdf:resource='http://id.loc.gov/authorities/subjects' or */@rdf:about='http://id.loc.gov/authorities/subjects'] or
                      */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='lcsh'">0</case>
          <case test="*/bf:source/bf:Source/bf:code='lcshac' or
                      */bf:source[@rdf:resource='http://id.loc.gov/authorities/childrensSubjects' or */@rdf:about='http://id.loc.gov/authorities/childrensSubjects'] or
                      */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='lcshac'">1</case>
          <case test="*/bf:source/bf:Source/bf:code='mesh' or
                      */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/mesh' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/mesh'] or
                      */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='mesh'">2</case>
          <case test="*/bf:source/bf:Source/bf:code='nal' or
                      */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/nal' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/nal'] or
                      */madsrdf:componentList/*[1]/*/bf:source/bf:Source/bf:code='nal'">3</case>
          <case test="*/bf:source/bf:Source/bf:code='cash' or
                      */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/cash' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/cash'] or
                      */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='cash'">5</case>
          <case test="*/bf:source/bf:Source/bf:code='rvm' or
                      */bf:source[@rdf:resource='http://id.loc.gov/vocabulary/subjectSchemes/rvm' or */@rdf:about='http://id.loc.gov/vocabulary/subjectSchemes/rvm'] or
                      */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code='rvm'">6</case>
          <case test="*/bf:source or */madsrdf:componentList/*[1]/bf:source">7</case>
          <case test="contains(@rdf:resource,'id.loc.gov/authorities/genreForms') or contains(*/@rdf:about,'id.loc.gov/authorities/genreForms') or contains(@rdf:resource,'id.loc.gov/vocabulary/marcgt') or contains(*/@rdf:about,'id.loc.gov/vocabulary/marcgt')">7</case>
        </switch>
      </ind2>
      <switch>
        <case test="*/madsrdf:componentList">
          <sf code="0"><select xpath="*/@rdf:about[not(contains(.,'example.org'))]"/></sf>
          <sf code="0">
            <select xpath="*/bf:identifiedBy/bf:Identifier">
              <transform>
                <xsl:variable name="vIdType">
                  <xsl:call-template name="tChopPunct">
                    <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                  </xsl:call-template>
                </xsl:variable>
                <xsl:choose>
                  <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                  <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                </xsl:choose>
              </transform>
            </select>
          </sf>
          <sf code="3" chopPunct="true" repeatable="false">
            <select xpath="*/bflc:appliesTo/bflc:AppliesTo/rdfs:label"/>
          </sf>
          <sf code="a" chopPunct="true" repeatable="false">
            <switch>
              <case test="*/madsrdf:componentList/*[1]/madsrdf:authoritativeLabel"><select xpath="*/madsrdf:componentList/*[1]/madsrdf:authoritativeLabel"/></case>
              <case test="default"><select xpath="*/madsrdf:componentList/*[1]/rdfs:label"/></case>
            </switch>
          </sf>
          <sf code="0"><select xpath="*/madsrdf:componentList/*[1]/@rdf:about[not(contains(.,'example.org'))]"/></sf>
          <sf code="0">
            <select xpath="*/madsrdf:componentList/*[1]/bf:identifiedBy/bf:Identifier">
              <transform>
                <xsl:variable name="vIdType">
                  <xsl:call-template name="tChopPunct">
                    <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                  </xsl:call-template>
                </xsl:variable>
                <xsl:choose>
                  <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                  <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                </xsl:choose>
              </transform>
            </select>
          </sf>
          <!-- subdivisions -->
          <select xpath="*/madsrdf:componentList/*">
            <switch>
              <case test="position() &gt; 1">
                <switch>
                  <case test="local-name()='GenreForm' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#GenreForm']">
                    <sf code="v" chopPunct="true">
                      <switch>
                        <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                        <case test="default"><select xpath="rdfs:label"/></case>
                      </switch>
                    </sf>
                  </case>
                  <case test="local-name()='Temporal' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Temporal']">
                    <sf code="y" chopPunct="true">
                      <switch>
                        <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                        <case test="default"><select xpath="rdfs:label"/></case>
                      </switch>
                    </sf>
                  </case>
                  <case test="local-name()='Geographic' or rdf:type[@rdf:resource='http://www.loc.gov/mads/rdf/v1#Geographic']">
                    <sf code="z" chopPunct="true">
                      <switch>
                        <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                        <case test="default"><select xpath="rdfs:label"/></case>
                      </switch>
                    </sf>
                  </case>
                  <case test="default">
                    <sf code="x" chopPunct="true">
                      <switch>
                        <case test="madsrdf:authoritativeLabel"><select xpath="madsrdf:authoritativeLabel"/></case>
                        <case test="default"><select xpath="rdfs:label"/></case>
                      </switch>
                    </sf>
                  </case>
                </switch>
                <sf code="0"><select xpath="@rdf:about[not(contains(.,'example.org'))]"/></sf>
                <sf code="0">
                  <select xpath="bf:identifiedBy/bf:Identifier">
                    <transform>
                      <xsl:variable name="vIdType">
                        <xsl:call-template name="tChopPunct">
                          <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                        </xsl:call-template>
                      </xsl:variable>
                      <xsl:choose>
                        <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                        <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                      </xsl:choose>
                    </transform>
                  </select>
                </sf>
              </case>
            </switch>
          </select>
        </case>
        <case test="default">
          <sf code="3" chopPunct="true" repeatable="false">
            <select xpath="*/bflc:appliesTo/bflc:AppliesTo/rdfs:label"/>
          </sf>
          <sf code="a" chopPunct="true" repeatable="false">
            <switch>
              <case test="*/madsrdf:authoritativeLabel">
                <select xpath="*/madsrdf:authoritativeLabel[1]"/>
              </case>
              <case test="default"><select xpath="*/rdfs:label[1]"/></case>
            </switch>
          </sf>
          <sf code="0"><select xpath="@rdf:resource[not(contains(.,'example.org'))]"/></sf>
          <sf code="0"><select xpath="*/@rdf:about[not(contains(.,'example.org'))]"/></sf>
          <sf code="0">
            <select xpath="*/bf:identifiedBy/bf:Identifier">
              <transform>
                <xsl:variable name="vIdType">
                  <xsl:call-template name="tChopPunct">
                    <xsl:with-param name="pString" select="bf:source/bf:Source/bf:code"/>
                  </xsl:call-template>
                </xsl:variable>
                <xsl:choose>
                  <xsl:when test="$vIdType != ''"><xsl:value-of select="concat('(',$vIdType,')',rdf:value)"/></xsl:when>
                  <xsl:otherwise><xsl:value-of select="rdf:value"/></xsl:otherwise>
                </xsl:choose>
              </transform>
            </select>
          </sf>
        </case>
      </switch>
      <!-- $2 if source not in ind2 -->
      <switch>
        <case test="*/bf:source/bf:Source/bf:code or */madsrdf:componentList/*[1]/bf:source/bf:Source/bf:code">
          <select xpath="*/bf:source|*/madsrdf:componentList/*[1]/bf:source">
            <var name="vSourceUri">
              <switch>
                <case test="@rdf:resource"><transform><xsl:value-of select="@rdf:resource"/></transform></case>
                <case test="*/@rdf:about"><transform><xsl:value-of select="*/@rdf:about"/></transform></case>
              </switch>
            </var>
            <switch>
              <case test="$vSourceUri != 'http://id.loc.gov/authorities/subjects' and
                          bf:Source/bf:code != 'lcsh' and
                          $vSourceUri != 'http://id.loc.gov/authorities/childrensSubjects' and
                          bf:Source/bf:code != 'lcshac' and
                          $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/mesh' and
                          bf:Source/bf:code != 'mesh' and
                          $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/nal' and
                          bf:Source/bf:code != 'nal' and
                          $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/cash' and
                          bf:Source/bf:code != 'cash' and
                          $vSourceUri != 'http://id.loc.gov/vocabulary/subjectSchemes/rvm' and
                          bf:Source/bf:code != 'rvm'">
                <sf code="2">
                  <switch>
                    <case test="bf:Source/bf:code"><transform><xsl:value-of select="bf:Source/bf:code"/></transform></case>
                    <case test="$vSourceUri != ''">
                      <switch>
                        <case test="contains($vSourceUri,'id.loc.gov')">
                          <transform>
                            <xsl:call-template name="tUriCode">
                              <xsl:with-param name="pUri" select="$vSourceUri"/>
                            </xsl:call-template>
                          </transform>
                        </case>
                        <case test="default"><transform><xsl:value-of select="$vSourceUri"/></transform></case>
                      </switch>
                    </case>
                    <case test="default"><transform><xsl:value-of select="bf:Source/rdfs:label"/></transform></case>
                  </switch>
                </sf>
              </case>
            </switch>
          </select>
        </case>
        <case test="contains(@rdf:resource,'id.loc.gov/authorities/genreForms') or contains(*/@rdf:about,'id.loc.gov/authorities/genreForms')">
          <sf code="2">lcgft</sf>
        </case>
        <case test="contains(@rdf:resource,'id.loc.gov/vocabulary/marcgt') or contains(*/@rdf:about,'id.loc.gov/vocabulary/marcgt')">
          <sf code="2">marcgt</sf>
        </case>
      </switch>
      <sf code="5" repeatable="false">
        <select xpath="*/bflc:applicableInstitution/*/bf:code"/>
      </sf>
    </context>
  </df>

</rules>
