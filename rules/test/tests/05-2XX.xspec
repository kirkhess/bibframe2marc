<?xml version="1.0" encoding="UTF-8"?>

<x:description xmlns:x="http://www.jenitennison.com/xslt/xspec"
               xmlns:marc="http://www.loc.gov/MARC21/slim"
               stylesheet="../../../bibframe2marc.xsl"
               xslt-version="1.0">

  <x:scenario label="MARC 210">
    <x:scenario label="MARC 210 from Work">
      <x:context href="../data/2XX/210-1.xml"/>
      <x:expect label="generate 210 from Work AbbreviatedTitle"
                test="count(//marc:datafield[@tag='210']) = 1"/>
      <x:expect label="ind1 default to 0"
                test="//marc:datafield[@tag='210']/@ind1 = '0'"/>
      <x:expect label="ind2 blank if issnkey assigner"
                test="//marc:datafield[@tag='210']/@ind2 = ' '"/>
      <x:expect label="$a from mainTitle"
                test="//marc:datafield[@tag='210']/marc:subfield[@code='a'] = 'Manage. improv. cost reduct. goals'"/>
      <x:expect label="$b from qualifier in parens"
                test="//marc:datafield[@tag='210']/marc:subfield[@code='b'] = '(Faridabad)'"/>
    </x:scenario>
    <x:scenario label="MARC 210 from Instance">
      <x:context href="../data/2XX/210-2.xml"/>
      <x:expect label="generate 210 from Instance AbbreviatedTitle"
                test="count(//marc:datafield[@tag='210']) = 1"/>
      <x:expect label="ind1 default to 0"
                test="//marc:datafield[@tag='210']/@ind1 = '0'"/>
      <x:expect label="ind2 default to 0"
                test="//marc:datafield[@tag='210']/@ind2 = '0'"/>
      <x:expect label="$a from mainTitle"
                test="//marc:datafield[@tag='210']/marc:subfield[@code='a'] = 'JAMA'"/>
      <x:expect label="$2 from assigner"
                test="//marc:datafield[@tag='210']/marc:subfield[@code='2'] = 'dnlm'"/>
    </x:scenario>
  </x:scenario>

  <x:scenario label="MARC 222">
    <x:context href="../data/2XX/222.xml"/>
    <x:expect label="generate 222" test="count(//marc:datafield[@tag='222']) = 1"/>
    <x:expect label="ind1 default to blank"
              test="//marc:datafield[@tag='222']/@ind1 = ' '"/>
    <x:expect label="ind2 from comparison between bflc:titleSortKey and rdfs:label"
              test="//marc:datafield[@tag='222']/@ind2 = '4'"/>
    <x:expect label="$a from mainTitle"
              test="//marc:datafield[@tag='222']/marc:subfield[@code='a'] = 'The Sourdough'"/>
    <x:expect label="$b from qualifier in parens"
              test="//marc:datafield[@tag='222']/marc:subfield[@code='b'] = '(Faridabad)'"/>
  </x:scenario>

  <x:scenario label="MARC 240">
    <x:context href="../data/2XX/240.xml"/>
    <x:expect label="generate 240 when Instance and Work title differ and there is a bf:PrimaryContribution"
              test="count(marc:record/marc:datafield[@tag='240']) = 1"/>
    <x:expect label="ind2 generated from delta between rdfs:label and bflc:titleSortKey"
              test="marc:record/marc:datafield[@tag='240']/@ind2 = '0'"/>
    <x:expect label="$a generated from bf:mainTitle"
              test="marc:record/marc:datafield[@tag='240']/marc:subfield[@code='a'] = 'Wilhelm Meisters Lehrjahre'"/>
    <!-- <x:expect label="$l generated from bf:Work/bf:language/bf:Language/rdfs:label" -->
    <!--           test="marc:record/marc:datafield[@tag='240']/marc:subfield[@code='l'] = 'English'"/> -->
  </x:scenario>

  <x:scenario label="Multi-script 241/245">
    <x:context href="../data/multi-script/241-245.xml"/>
    <x:expect label="generate 241 from transliterated title"
              test="count(//marc:datafield[@tag='241']) = 1"/>
    <x:expect label="241 data from transliterated properties"
              test="//marc:datafield[@tag='241']/marc:subfield[@code='a'] = 'Nei Menggu Lang Shan--Seerteng Shan shan qian huo dong duan lie dai di zhi tu'"/>
    <x:expect label="generate 245 from vernacular title"
              test="count(//marc:datafield[@tag='245']) = 1"/>
    <x:expect label="245 data from vernacular properties"
              test="//marc:datafield[@tag='245']/marc:subfield[@code='a'] = '内蒙古狼山--色尔滕山山前活动断裂带地质图'"/>
  </x:scenario>

  <x:scenario label="MARC 242">
    <x:context href="../data/2XX/242.xml"/>
    <x:expect label="generate 242" test="count(//marc:datafield[@tag='242']) = 1"/>
  </x:scenario>

  <x:scenario label="MARC 243">
    <x:context href="../data/2XX/243.xml"/>
    <x:expect label="generate 243" test="count(//marc:datafield[@tag='243']) = 1"/>
  </x:scenario>

  <x:scenario label="MARC 245">
    <x:context href="../data/2XX/245.xml"/>
    <x:expect label="...should be generated from bf:Instance/bf:title/bf:Title"
              test="count(marc:record/marc:datafield[@tag='245']) = 1"/>
    <x:expect label="ind1 generated based on Work primary contribution"
              test="//marc:datafield[@tag='245']/@ind1 = '1'"/>
    <x:expect label="...ind2 generated by subtracting length of bflc:titleSortKey from rdfs:label"
              test="marc:record/marc:datafield[@tag='245']/@ind2 = '4'"/>
    <x:expect label="...$a generated by bf:mainTitle"
              test="marc:record/marc:datafield[@tag='245']/marc:subfield[@code='a'] = 'The man who spoke Snakish'"/>
    <x:expect label="...$b generated by bf:subtitle"
              test="marc:record/marc:datafield[@tag='245']/marc:subfield[@code='b'] = 'a novel'"/>
    <x:expect label="...$c generated by bf:Instance/bf:responsibilityStatement"
              test="marc:record/marc:datafield[@tag='245']/marc:subfield[@code='c'] = 'by Andrus Kivirähk'"/>
    <x:expect label="...$n generated by bf:partNumber"
              test="marc:record/marc:datafield[@tag='245']/marc:subfield[@code='n'] = '1'"/>
    <x:expect label="...$p generated by bf:partName"
              test="marc:record/marc:datafield[@tag='245']/marc:subfield[@code='p'] = 'part one'"/>
  </x:scenario>

  <x:scenario label="MARC 245 no bf:mainTitle">
    <x:context href="../data/2XX/245-1.xml"/>
    <x:expect label="...should generate $a from rdfs:label"
              test="marc:record/marc:datafield[@tag='245']/marc:subfield[@code='a'] = 'The man who spoke Snakish : a novel / by Andrus Kivirähk'"/>
  </x:scenario>

  <x:scenario label="MARC 245 only generated if Title not subclassed">
    <x:context href="../data/2XX/245-2.xml"/>
    <x:expect label="No 245 generated"
              test="count(//marc:datafield[@tag='245']) = 0"/>
  </x:scenario>

  <x:scenario label="MARC 246">
    <x:context href="../data/2XX/246.xml"/>
    <x:expect label="generate 246" test="count(//marc:datafield[@tag='246']) = 1"/>
    <x:expect label="$i from note"
              test="//marc:datafield[@tag='246']/marc:subfield[@code='i'] = 'Cover title'"/>
  </x:scenario>

  <x:scenario label="MARC 247">
    <x:context href="../data/2XX/247.xml"/>
    <x:expect label="generate 247" test="count(//marc:datafield[@tag='247']) = 1"/>
    <x:expect label="$b from subtitle"
              test="//marc:datafield[@tag='247']/marc:subfield[@code='b'] = 'for every woman'"/>
  </x:scenario>

  <x:scenario label="MARC 250">
    <x:context href="../data/2XX/250.xml"/>
    <x:expect label="generate 250" test="count(//marc:datafield[@tag='250']) = 1"/>
    <x:expect label="$a from editionStatement"
              test="//marc:datafield[@tag='250'][1]/marc:subfield[@code='a'] = 'Third edition'"/>
  </x:scenario>

  <x:scenario label="MARC 254">
    <x:context href="../data/2XX/254.xml"/>
    <x:expect label="generate 254" test="count(//marc:datafield[@tag='254']) = 1"/>
    <x:expect label="ind1 default to blank"
              test="//marc:datafield[@tag='254']/@ind1 = ' '"/>
    <x:expect label="ind2 default to blank"
              test="//marc:datafield[@tag='254']/@ind2 = ' '"/>
    <x:expect label="$a from label"
              test="//marc:datafield[@tag='254']/marc:subfield[@code='a'] = 'Partitur'"/>
  </x:scenario>

  <x:scenario label="MARC 255">
    <x:context href="../data/2XX/255.xml"/>
    <x:expect label="generate 255 from scale or cartographicAttributes of Work (but only if correct properties are available)"
              test="count(//marc:datafield[@tag='255']) = 4"/>
    <x:expect label="$a from scale literal" test="//marc:datafield[@tag='255'][1]/marc:subfield[@code='a'] = 'Scale varies'"/>
    <x:expect label="...or from bf:Scale object" test="//marc:datafield[@tag='255'][2]/marc:subfield[@code='a'] = 'Scale [ca. 1:90,000]'"/>
    <x:expect label="...or from bf:Scale/bf:note"
              test="//marc:datafield[@tag='255'][3]/marc:subfield[@code='a'] = 'Linear scale'"/>
    <x:expect label="$b from projection" test="//marc:datafield[@tag='255']/marc:subfield[@code='b'] = 'Chamberlin trimetric proj.'"/>
    <x:expect label="$c from coordinates" test="//marc:datafield[@tag='255']/marc:subfield[@code='c'] = 'W 125°--W 65°/N 49°--N 25°'"/>
    <x:expect label="$d from ascensionAndDeclination" test="//marc:datafield[@tag='255']/marc:subfield[@code='d'] = 'Zones +90° to +81° to 63°, -81° to 98°'"/>
    <x:expect label="$e from equinox" test="//marc:datafield[@tag='255']/marc:subfield[@code='e'] = 'eq. 1950'"/>
    <x:expect label="$f from outerGRing" test="//marc:datafield[@tag='255']/marc:subfield[@code='f'] = 'W 84˚00´00ʺ--W 75˚00´00ʺ/N 40˚00´00ʺ--N 37˚30´00ʺ'"/>
    <x:expect label="$g from exclusionGRing" test="//marc:datafield[@tag='255']/marc:subfield[@code='g'] = 'W 84˚00´00ʺ--W 75˚00´00ʺ/N 40˚00´00ʺ--N 37˚30´00ʺ'"/>
  </x:scenario>

  <!-- tests for MARC 256 in with notes in 5XX rules -->

  <x:scenario label="MARC 264">
    <x:context href="../data/2XX/264.xml"/>
    <x:expect label="generate 264" test="count(//marc:datafield[@tag='264']) = 2"/>
  </x:scenario>

</x:description>
